trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: LintAndUnitTest
  jobs:
  - job: LintAndUnitTest
    displayName: 'Lint and Unit Test'
    steps:
    - script: 'echo "Starting Linting"'
      displayName: 'Starting Linting'

    - script: 'chmod +x ./gradlew'
      displayName: 'Grant Execute Permission'

    - script: './gradlew lint'
      displayName: 'Run Linting'

    - script: 'echo "Linting Completed"'
      displayName: 'Linting Completed'

    - script: 'echo "Starting Unit Testing"'
      displayName: 'Starting Unit Testing'

    - script: './gradlew test'
      displayName: 'Run Unit Tests'

    - script: 'echo "Unit Testing Completed"'
      displayName: 'Unit Testing Completed'
 # Add Java Tool Installer task to set JDK version, architecture, and source
    - task: JavaToolInstaller@0
      inputs:
        versionSpec: '17'
        jdkArchitectureOption: 'x64'
        jdkSourceOption: 'PreInstalled'
 
- stage: BuildImage
  jobs:
  - job: BuildDockerImage
    displayName: 'Build Docker Image'
    steps:
    - script: |
        # Navigate to your project directory where the Dockerfile is located
        cd path/to/your/project

        # Build the Docker image
        docker build -t your-image-name:your-tag .

        # Log in to Docker Hub or your container registry
        docker login -u your-username -p your-password

        # Push the Docker image to the registry
        docker push your-username/your-image-name:your-tag

        # Log out of Docker
        docker logout
      displayName: 'Build and Push Docker Image'

- stage: PullImage
  jobs:
  - job: PullDockerImage
    displayName: 'Pull Docker Image'
    steps:
    - script: |
        # Log in to Docker Hub or your container registry
        docker login -u your-username -p your-password

        # Pull the Docker image from the registry
        docker pull your-username/your-image-name:your-tag

        # Log out of Docker
        docker logout
      displayName: 'Pull Docker Image'
